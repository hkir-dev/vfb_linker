	section	paragraph	sentence	text
1	Title	1	1	Distributed control of motor circuits for backward walking in Drosophila
2	Abstract	1	1	How do descending inputs from the brain control leg motor circuits to change how an animal walks?
3	Abstract	1	2	Conceptually, descending neurons are thought to function either as command-type neurons, in which a single type of descending neuron exerts a high-level control to elicit a coordinated change in motor output, or through a population coding mechanism, whereby a group of neurons, each with local effects, act in combination to elicit a global motor response.
4	Abstract	1	3	The Drosophila Moonwalker Descending Neurons (MDNs), which alter leg motor circuit dynamics so that the fly walks backwards, exemplify the command-type mechanism.
5	Abstract	1	4	Here, we identify several dozen MDN target neurons within the leg motor circuits, and show that two of them mediate distinct and highly-specific changes in leg muscle activity during backward walking: LBL40 neurons provide the hindleg power stroke during stance phase; LUL130 neurons lift the legs at the end of stance to initiate swing.
6	Abstract	1	5	Through these two effector neurons, MDN directly controls both the stance and swing phases of the backward stepping cycle.
7	Abstract	1	6	These findings suggest that command-type descending neurons can also operate through the distributed control of local motor circuits.
8	Abstract	2	1	Drosophila Moonwalker Descending Neurons (MDNs) alter leg motor circuit dynamics so that the fly walks backwards.
9	Abstract	2	2	The authors identify two MDN effector neurons that directly control the stance and swing phases of the backward stepping cycle, indicating distributed control of local motor circuits via command-type descending neurons.
10	Introduction	1	1	The simple act of walking appears effortless, yet involves the exquisitely timed and scaled activation of multiple muscles in each leg.
11	Introduction	1	2	The motor circuits that produce these muscle movements are controlled by descending inputs from the brain and sensory feedback from the legs [1], [2].
12	Introduction	1	3	The descending inputs modulate the overall locomotor pattern, effecting changes in direction or pace in accordance with the animal’s behavioral goals [3], [4].
13	Introduction	1	4	Sensory feedback, including both external and proprioceptive signals, coordinate progression through the stepping cycle and make the fine adjustments needed to adapt to a varying terrain [5].
14	Introduction	1	5	While this overall organization is now well established, we still have only very limited understanding of how such descending and peripheral inputs control locomotor circuits [6].
15	Introduction	1	6	Determining how descending and peripheral inputs control motor circuits for walking thus remains an important open question in basic neuroscience, with the potential to inform approaches in human therapy [7] and robotics [8].
16	Introduction	2	1	One of the most striking descending controls of leg motor circuits effects a transition from forward to backward walking.
17	Introduction	2	2	Virtually all animals are capable of walking backwards, albeit with varying degrees of elegance.
18	Introduction	2	3	The most obvious change in leg kinematics in backward walking is the phase switch in leg movements-from the leg moving forward in swing phase and backward in stance phase, to forward in stance phase and backward in swing phase.
19	Introduction	2	4	Yet backward walking involves much more than just a simple phase switch, as the amplitude and speed of movement at each joint must also be altered for smooth backward propulsion [9], [10].
20	Introduction	2	5	Additionally, for animals with multiple pairs of legs, the hindlegs rather than the forelegs are now the first to encounter the oncoming terrain.
21	Introduction	2	6	The transition to backward walking thus provides an excellent paradigm to explore the more general question of how descending inputs from the brain make the myriad adjustments in motor circuits necessary to effect a smooth and coordinated change in walking direction.
22	Introduction	3	1	Here we begin to investigate the descending control of locomotor circuits for backward walking in Drosophila.
23	Introduction	3	2	Flies, like many other animals, retreat if they perceive a threat or obstacle in the path ahead.
24	Introduction	3	3	These sensory cues are believed to act primarily through a single class of descending neurons, called the Moonwalker Descending Neurons (MDNs), which act as command-type neurons for backward walking [11].
25	Introduction	3	4	Flies with genetically silenced MDNs are unable to walk backwards when they encounter a physical obstacle.
26	Introduction	3	5	Conversely, freely roaming flies walk backwards if the MDNs are artificially activated [11].
27	Introduction	3	6	MDNs receive input from neurons conveying mechanosensory cues [12] (representing a possible obstacle) and from visual neurons that detect a looming stimulus [13] (a potential threat).
28	Introduction	3	7	The MDNs are also present in larvae, where they mediate backward crawling [14].
29	Introduction	3	8	Presumably, MDNs control very different motor circuits in the larvae and adult, as the former produce peristaltic waves of the body wall musculature whereas the latter generate the stepping action of legs.
30	Introduction	3	9	While some progress has been made in identifying the larval motor circuits that the MDNs engage for backward crawling [14], the motor circuits they activate in the adult for backward walking remain unknown.
31	Introduction	4	1	By studying leg joint kinematics, we found that the adult MDNs drive coordinated changes in stepping patterns across all three pairs of legs, with the strongest impact on the hindlegs.
32	Introduction	4	2	By combining anatomical and functional approaches, we identify several dozen morphologically distinct candidate MDN target cell types in the ventral nerve cord (VNC).
33	Introduction	4	3	Using cell-type specific genetic drivers, we confirmed that many of these cell types are indeed required for backward walking, and analyzed two of them in detail.
34	Introduction	4	4	The LBL40 neurons-specific to the T3 segment-mediate tibia flexion during the power stroke of backward walking.
35	Introduction	4	5	The LUL130 neurons-present in all segments but activated by MDN most strongly in T3-lift the hindlegs to initiate swing phase.
36	Introduction	4	6	These two MDN-effector neurons thus mediate two critical hindleg movements in backward walking: the power stroke during stance phase (LBL40) and elevation at the start of swing phase (LUL130).
37	Introduction	5	1	Models for the descending control of motor circuits have generally emphasized either of two extreme scenarios: a command-type of control, in which a single type of descending neuron, like MDN, effects a coordinated set of changes of many muscle movements, versus a more distributed, population-type of control, in which a single type of descending neuron modulates a limited set of motor outputs, with many such descending inputs working in combination to produce a coordinated pattern of muscle movements.
38	Introduction	5	2	Intuitively, command-type descending neurons might be expected to exert a relatively high-level, centralized control on motor circuits, whereas population-type descending neurons might impinge at a lower level, close to the specific motor outputs they control.
39	Introduction	5	3	Our analysis of MDN outputs suggests, however, that command-type neurons can also act in a highly distributed and localized manner: We propose that MDN acts as a command-type neuron because its distributed outputs collectively effect a state switch in motor circuit network dynamics-from a resting or forward walking state to a backward walking state.
40	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	1	Before embarking on a detailed investigation of how MDN couples to leg motor circuits, we first sought to better understand how MDN activation impacts leg movements.
41	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	2	Previous studies of MDN-triggered backward walking have examined only the translocation of the body [11-13] or the pattern of footfalls [11].
42	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	3	To determine how MDN alters leg joint kinematics, we acquired high-speed (200 fps) videos of tethered flies walking on a suspended ball [15], and used the DeepLabCut software [16] to train a neural network to automatically detect the positions of each leg joint (Fig 1a and Supplementary Movie 1).
43	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	4	Each of the 6 legs has 4 highly articulated joints.
44	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	5	From proximal to distal, these are the body-coxa, coxa-trochanter, femur-tibia, and tibia-tarsus joints (Fig 1b.
45	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	6	In Drosophila, as in many other insects [17], the trochanter-femur joint has limited mobility).
46	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	7	These joints, as well as the tarsal tips, were located for all three legs on one side of the body in each video frame (Fig 1a, b).
47	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	1	8	We analyzed videos of both spontaneous forward walking and MDN-triggered backward walking (Fig 1b-h).
48	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	1	The trajectories of the tarsal tips differed considerably during bouts of forward and backward walking by the same fly (Fig 1c and Supplementary Movie 1).
49	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	2	The forelegs stepped further and higher when walking forwards than when walking backwards; the hindlegs took longer and higher strides when walking backwards (Fig 1c-f).
50	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	3	The fore- and hindlegs are generally oriented parallel to the fly’s body axis, and so the lateral placement of our video camera provides the best perspective for tracking joint angles in these legs.
51	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	4	We found that the two joints with the greatest range of motion in both forward and backward walking were the coxa-trochanter and femur-tibia joints (Fig 1b, d, g, h).
52	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	5	The flexion and extension of these two joints occurred synchronously for each leg, but in opposite stepping phases for forelegs versus hindlegs (Fig 1d).
53	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	6	During forward walking, the foreleg coxa-trochanter and femur-tibia joints were flexed in stance phase and extended in swing phase; the hindleg joints were flexed in swing and extended in stance.
54	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	7	The phase coupling of flexion and extension was reversed during MDN-triggered backward walking.
55	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	8	Thus, the forelegs appear to pull the body forward during forward walking, with the hindlegs either pushing or passively extending.
56	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	9	For backward walking, the hindlegs pull, while the forelegs either push or passively extend.
57	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	2	10	Regardless of which direction the fly walks, the leading legs take the higher steps, which may facilitate walking on uneven terrain or over obstacles.
58	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	1	To assess whether the hindlegs indeed provide the greatest propulsive force during backward walking, we next performed a series of amputation experiments.
59	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	2	In these experiments, we first monitored leg joint kinematics in an intact fly upon MDN activation, then bilaterally amputated the tarsal tips from one pair of legs before again activating MDN and videotaping leg movements.
60	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	3	Tarsal amputation prevents the leg from gaining any traction on the ground but preserves all the leg joints.
61	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	4	We found that the fore- and midleg amputees were still able to walk backwards, whereas the hindleg amputees could not (Fig 1i, j and Supplementary Movie 2).
62	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	5	Thus, it is primarily the stance phase power stroke of the hindleg that drives the body backwards when MDN is activated.
63	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	6	Interestingly, in all cases, the amputated legs continued to oscillate, suggesting that their stepping motion is actively driven by central motor circuits and not merely a passive consequence of their surface traction (Fig 1i, j and Supplementary Movie 2).
64	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	3	7	We also noticed that, particularly for the hindlegs, but to a lesser extent also the midlegs, the stepping frequency even increased upon amputation, as if they were continually seeking surface contact (Fig 1j).
65	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	4	1	We conclude from this series of experiments that MDN induces backward walking predominantly by engaging the muscles that control the hindleg coxa-trochanter and femur-tibia joints.
66	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	4	2	MDN switches the phases of flexion and extension for these joints during the stepping cycle, and enhances their movement in the hindleg so as to mirror those of the corresponding foreleg joints during forward walking.
67	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	4	3	As a result of these adjustments to hindleg stepping, it is the hindlegs that provide the main propulsive force during backward walking.
68	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	4	4	MDN likely also provides neural input to the midleg and foreleg motor circuits.
69	Results; Joint kinematics suggest that hindlegs dominate MDN-triggered backward walking	4	5	However, MDN’s impact in these segments is considerably weaker and, in the absence of any drive from the hindlegs, insufficient to propel the animal backwards.
70	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	1	Having determined how MDN activation changes leg kinematics, we next sought to trace the neural circuits through which MDN effects these changes.
71	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	2	In a first approach, we used the trans-Tango method [18] to identify cells in the VNC likely to be postsynaptic to MDNs.
72	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	3	Trans-Tango employs a heterologous ligand to activate its cognate receptor in postsynaptic cells, which then become labeled by expression of a QF-dependent reporter.
73	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	4	We targeted the trans-Tango ligand to MDNs and the trans-Tango receptor to all neurons, and acquired confocal images of the VNC to visualize postsynaptic cells labeled by an mtdTomato-3HA reporter (Fig 2a).
74	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	5	A large number of cells in the VNC were MDN trans-Tango-positive, and, as expected, their neurites overlap extensively with the axonal arborizations of the MDNs in all three leg neuropils (Fig 2a).
75	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	6	This high density of trans-Tango labeling precluded the identification of individual cell types.
76	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	7	In order to visualize single trans-Tango-positive cells, we therefore used a stochastic variant of trans-Tango [18] in which only a small subset of the postsynaptic cells were labeled in any one sample (Fig 2b).
77	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	8	A total of 541 samples were imaged by confocal microscopy and registered onto a common reference template (ref.
78	Results; Trans-Tango reveals cells postsynaptic to MDNs	1	9	[19]; Fig 2b).
79	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	1	The cell types labeled by trans-Tango were highly diverse in their morphology.
80	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	2	We identified 65 morphologically distinct cell types amongst the 541 samples, and segmented a representative cell of each class (Fig 2c).
81	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	3	Collectively, these neurons appear to encompass the full pattern of trans-Tango-positive cells (Fig 2b).
82	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	4	These cell types comprise nine morphologically distinct ascending neurons and 56 interneurons.
83	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	5	We did not detect any motor neurons directly postsynaptic to the MDNs.
84	Results; Trans-Tango reveals cells postsynaptic to MDNs	2	6	For the purposes of this work, we assigned these cell types provisional names starting with MT (for “MDN trans-Tango”), followed by either an A for ascending neurons or 1, 2, or 3 for interneurons in the T1, T2, or T3 segments, respectively, and finally a consecutive two-digit number (Fig 2c).
85	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	1	Labeling with trans-Tango neither provides information as to the strength or sign of synaptic connections, nor can it reveal cell types that are functionally responsive to the MDNs but not amongst their immediate postsynaptic partners.
86	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	2	We therefore complemented this anatomical approach with volumetric functional imaging (Fig 3a).
87	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	3	We optogenetically activated the MDNs using CsChrimson [20] and monitored calcium responses at 1 Hz in the VNC with GCaMP6s [21].
88	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	4	MDN was activated with a series of 20-s red-light pulses, one per minute over a 10-min period.
89	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	5	Responsive cells were identified using a voxel-wise analysis of covariance with a kernel that captures the dynamics of the stimulus protocol and GCaMP6s response kinetics (Fig 3a).
90	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	1	6	In initial experiments in which GCaMP6s was expressed in all neurons, or all glutamatergic neurons, we reproducibly observed both excitatory and inhibitory responses in the VNC, predominantly but not exclusively in the T3 segment (Fig 3b and Supplementary Movie 3).
91	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	1	In functional imaging experiments in which GCaMP6s was broadly expressed, it was not possible to reliably identify individual responsive cells.
92	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	2	We therefore used an iterative approach in which we screened selected lines from large collections of GAL4 or LexA drivers [22], [23].
93	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	3	We started with a panel of relatively broadly expressed lines, and then, for any line in which we detected MDN-responsive cells, iteratively examined successively sparser lines likely to contain these cells.
94	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	4	Additionally, we included sparse driver lines likely to include any of the cell types identified in the trans-Tango experiments.
95	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	5	For the sparsest lines in which a GCaMP6s response was observed, we identified the specific cell type that was MDN-responsive by matching the pattern of correlated voxels to a series of images of single cells obtained by stochastic labeling [24] using a driver line containing the same enhancer (Fig 3c).
96	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	2	6	These identified neurons were then manually segmented from the stochastically labeled samples.
97	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	3	1	While this iterative sampling approach inevitably fails to isolate all the MDN-responsive cells, it was sufficiently broad in scope to allow us to resolve a total of 33 morphologically distinct MDN-responsive cell types (Fig 3d-f).
98	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	3	2	We provisionally refer to these cell types here as MF cells (MDN functional imaging).
99	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	3	3	As for the MT cells identified with trans-Tango, the MF cells also include both interneurons (Fig 3d) and ascending neurons (Fig 3e), and are predominantly located in T3.
100	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	3	4	Additionally, one type of MDN-responsive motor neuron was identified in the functional imaging experiments (Fig 3f).
101	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	3	5	Not surprisingly, and indeed in part due to our search strategy, there is considerable overlap amongst the cells identified by trans-Tango and by functional imaging, with a total of 20 cell types detected by both methods (Supplementary Fig 1).
102	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	1	The MF cells exhibit a diverse array of responses to MDN activation (Fig 3d-f and Supplementary Fig 2).
103	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	2	Most MF cell types showed a positive calcium response upon MDN activation, as expected given that the MDNs are cholinergic, and hence excitatory, and that GCaMP6s more reliably reports excitation than inhibition.
104	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	3	Some cells however consistently showed inhibitory responses to MDN activation.
105	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	4	None of these inhibited cells were trans-Tango positive, and indeed would not be expected to be directly postsynaptic to the excitatory MDNs.
106	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	5	Both the excitatory and inhibitory responses varied considerably in their amplitude and dynamics, even amongst segmentally repeated cells of the same type.
107	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	6	For example, the MF09, MF13, and MF25 cells are each present in all three segments, yet MDN activation elicited strong activation only in the T3 MF09s, the T1 and T2 MF13s, and the T1 and T3 MF25 (Fig 3d).
108	Results; Volumetric calcium imaging reveals cell types responsive to MDN activation	4	7	An even more dramatic example of segment-specific MDN responses is MF14, for which the T1 and T2 cells were excited but the T3 cells inhibited (Fig 3d).
109	Results; Several MF cell types contribute to MDN-induced backward walking	1	1	Even the sparsest driver lines we used to identify the MF cells in the functional imaging experiments typically label several additional cell types.
110	Results; Several MF cell types contribute to MDN-induced backward walking	1	2	Although these other cell types are not MDN-responsive, they may nonetheless contribute directly or indirectly to walking.
111	Results; Several MF cell types contribute to MDN-induced backward walking	1	3	This initial set of GAL4 driver lines was therefore not ideal for a functional analysis of the MF cells in backward walking, and so we instead used the split-GAL4 method [23], [25], [26] to generate highly specific driver lines for selected MF cells.
112	Results; Several MF cell types contribute to MDN-induced backward walking	1	4	These lines were generated as part of a larger effort to systematically classify and genetically target each of the neuronal cell types in the leg neuropils (R.M., K.F., B.J.D., in preparation).
113	Results; Several MF cell types contribute to MDN-induced backward walking	1	5	We matched each of the segmented MF cell profiles to specific cell types defined in this systematic classification, thereby identifying a total of 82 stable split-GAL4 (SS) lines that collectively covered 29 of the 33 MF cell types (Fig 4a and Supplementary Fig 3a).
114	Results; Several MF cell types contribute to MDN-induced backward walking	2	1	We then used these split-GAL4 driver lines to determine whether genetically silencing each class of MF cell was able to suppress MDN-induced backward walking in an open arena (Fly Bowl [27]).
115	Results; Several MF cell types contribute to MDN-induced backward walking	2	2	For this we generated flies in which CsChrimson was expressed in MDNs using a split-LexA driver, and tetanus toxin light chain [28] in a single class of MF cells using one of the SS lines (Supplementary Fig 4).
116	Results; Several MF cell types contribute to MDN-induced backward walking	2	3	As a negative control we used an empty GAL4 driver (lacking an enhancer element); as positive controls we used two different MDN GAL4 drivers (MDN-1-GAL4 and MDN + MAN-1-GAL4) [11].
117	Results; Several MF cell types contribute to MDN-induced backward walking	2	4	For each of these genotypes, we typically examined a total of ~50 flies distributed across two trials for their locomotion responses to red-light stimulation (Supplementary Fig 3b and Supplementary Movie 4).
118	Results; Several MF cell types contribute to MDN-induced backward walking	2	5	Figure 4b shows the mean backward locomotion during the stimulus period for each of the 82 MF split-GAL4 lines and the three controls.
119	Results; Several MF cell types contribute to MDN-induced backward walking	2	6	Robust backward walking was observed upon MDN activation in negative control flies, but completely abolished in both of the positive controls (Fig 4b).
120	Results; Several MF cell types contribute to MDN-induced backward walking	2	7	Similarly, for several MF cell types, multiple driver lines all resulted in a strong impairment of backward walking.
121	Results; Several MF cell types contribute to MDN-induced backward walking	2	8	Some of these also exhibited defects in spontaneous forward walking (Supplementary Fig 3b), but many specifically disrupted backward walking.
122	Results; Several MF cell types contribute to MDN-induced backward walking	2	9	Of these, we decided to focus our further analysis on two of the cell types for which we had the most SS driver lines and the most consistent reduction of backward walking: MF01, which corresponds to the LBL40 cells in our systematic classification of leg neuropil neurons, and MF09, which corresponds to LUL130.
123	Results; Several MF cell types contribute to MDN-induced backward walking	2	10	For these two cells types, a total of 6 and 4 SS driver lines, respectively, were all able to suppress MDN-induced backward walking.
124	Results; Several MF cell types contribute to MDN-induced backward walking	2	11	We next asked if and how each of these two cell types contributes to MDN’s effect on hindleg joint movements.
125	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	1	The LBL40 cells, identified in both the MDN trans-Tango (MT315, Fig 2c) and functional imaging experiments (MF01, Fig 3d and Supplementary Movie 5), are a bilateral pair of neurons specific to the T3 neuropils (Fig 5a).
126	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	2	They resemble the only surviving neurons of the 14B lineage [29].
127	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	3	Each of 6 LBL40 split-GAL4 driver lines reduced MDN-induced backward walking in the neuronal silencing experiments (Fig 4b).
128	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	4	The most restricted of these lines are SS47938 and SS46243.
129	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	5	SS47938 labels no other cells in the central nervous system, whereas SS46243 additionally labels a pair of ascending neurons (Supplementary Fig 3a).
130	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	1	6	Using these two cell-type-specific driver lines in calcium imaging experiments, we confirmed that the LBL40 neurons indeed respond to MDN activation (Fig 5b).
131	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	2	1	If the LBL40 neurons mediate specific joint movements during MDN-induced backward walking, then optogenetic activation of these neurons in stationary flies might elicit these joint movements in isolation.
132	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	2	2	We tested this prediction using tethered, decapitated flies.
133	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	2	3	Decapitation removes all descending inputs to the leg motor circuits, so that any leg movements induced by optogenetic activation of leg interneurons are not obscured by movements triggered by brain activity.
134	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	2	4	A tethered, decapitated fly is normally stationary, but optogenetic activation of the severed VNC projections of the MDNs induces backward walking, with its characteristically exaggerated hindleg movements (Supplementary Fig 5).
135	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	1	In this decapitated fly preparation, optogenetic activation of LBL40 using either SS47938 or SS46243 reliably induced hindleg tibia flexion at stimulus onset (Fig 5c, d [arrows], and e).
136	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	2	As the stimulus persisted, the initial tibia flexion was occasionally followed by rapid leg lifting and extension to execute a full backward step cycle (arrowheads in Fig 5d).
137	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	3	A similar pattern of tibia flexion, followed in some cases by stepping, was also seen in a series of experiments using a shorter 50 ms stimulus (Fig 5f and Supplementary Movie 6).
138	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	4	With this shorter stimulus, the stepping occurred with a variable delay and outside the stimulus window, suggesting that it is not a direct consequence of LBL40 activation.
139	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	5	If stepping occurred, it was initiated from a small joint angle (Fig 5g).
140	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	3	6	However, there was no significant difference in the minimum angle reached in stepping versus non-stepping trials, suggesting that reaching this small angle does not automatically trigger the next swing phase (Fig 5g).
141	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	1	These photoactivation experiments suggest that LBL40 is a premotor neuron for tibia flexion.
142	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	2	The single class of motor neuron identified in our functional imaging experiments, MF33, has a morphology that matches that of the motor neurons innervating the tibia-reductor muscle [30], [31], which is responsible for tibia flexion [32], [33].
143	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	3	In our systematic classification of neurons in the leg neuropils, we designated these as the LUM9 neurons (R.M., K.F., and B.J.D., in preparation).
144	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	4	They are present in each segment, but upon MDN stimulation are preferentially activated in T3 (Fig 3f).
145	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	5	We confirmed that the LUM9 neurons are indeed the tibia-reductor motor neurons by examining their muscle innervation in the leg (Supplementary Fig 6a).
146	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	6	As expected, optogenetic activation of the LUM9 neurons induced hindleg tibia flexion, albeit without the re-extension that was observed with LBL40 activation (Supplementary Fig 6b-d).
147	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	4	7	Calcium imaging experiments demonstrated that the T3 LUM9 neurons are activated upon stimulation of either the LBL40 neurons (Fig 5h, i) or the MDNs (Supplementary Fig 6e), and a GRASP experiment [34] suggested that they are direct synaptic partners of the LBL40 cells (Supplementary Fig 6f).
148	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	5	1	We conclude from these experiments that LBL40 activates the LUM9 neurons to induce hindleg tibia flexion.
149	Results; LBL40 neurons trigger tibia flexion via the tibia-reductor motor neurons	5	2	LBL40 and LUM9 are thus candidates to provide the hindleg power stroke during the stance phase of backward walking.
150	Results; LUL130 neurons trigger leg lifting	1	1	Like the LBL40 neurons, the LUL130 neurons were also identified in both the MDN trans-Tango (MT323, Fig 2c) and functional imaging experiments (MF09, Fig 3d and Supplementary Movie 7), and are also required for robust MDN-induced backward walking (Fig 4b).
151	Results; LUL130 neurons trigger leg lifting	1	2	LUL130 neurons are segmentally repeated local interneurons, but were most strongly activated by MDN in T3 (Fig 6a).
152	Results; LUL130 neurons trigger leg lifting	1	3	The T2 LUL130 neurons responded less strongly to MDN activation, and no response was detected in the T1 LUL130s.
153	Results; LUL130 neurons trigger leg lifting	1	4	The most restricted split-GAL4 lines we obtained for these neurons are SS50974 and SS50975.
154	Results; LUL130 neurons trigger leg lifting	1	5	SS50974 labels only the T3 cells, whereas SS50975 labels cells in all three thoracic segments (Fig 6b).
155	Results; LUL130 neurons trigger leg lifting	1	6	Neither driver labels any other cells in the CNS (Supplementary Fig 3a).
156	Results; LUL130 neurons trigger leg lifting	1	7	We confirmed with these drivers that both the T2 and T3 LUL130 neurons are activated upon optogenetic stimulation of the MDNs (Fig 6b; note that SS50975 drives weaker expression in T3 than in T1 and T2).
157	Results; LUL130 neurons trigger leg lifting	2	1	Using decapitated and tethered flies, we found that optogenetic activation of LUL130 induces lifting and a swing-like movement of the leg.
158	Results; LUL130 neurons trigger leg lifting	2	2	With the SS50974 driver, only the hindlegs were lifted (Fig 6c-e and Supplementary Movie 8); with SS50975, all six legs were lifted (Fig 6d, e).
159	Results; LUL130 neurons trigger leg lifting	2	3	We examined the hindleg lifting induced by SS50974 activation more closely and observed that a single brief (5 ms) pulse of red-light stimulation elicited a coordinated sequence of leg movements involving all three joints and resembling the swing phase of backward walking (Fig 6f).
160	Results; LUL130 neurons trigger leg lifting	2	4	Using the SS50975 driver to activate the LUL130 neurons in all three segments, we found that a longer red-light stimulus (5 s) resulted in an alternating pattern of stepping across all six legs.
161	Results; LUL130 neurons trigger leg lifting	2	5	Despite the simultaneous optogenetic activation of all LUL130 neurons, the legs stepped in a coordinated pattern similar to that typically observed in forward walking, with the fore- and hindlegs on one side of the body in phase with the midlegs on the other (Fig 6g, h and Supplementary Movie 9; refs.
162	Results; LUL130 neurons trigger leg lifting	2	6	[35], [36]).
163	Results; LUL130 neurons trigger leg lifting	2	7	These data suggest that the LUL130 neurons initiate swing phase, which then follows the normal pattern of both inter-joint and interleg coordination.
164	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	1	Finally, we sought to test the functional hypotheses we derived from the activation experiments: that LBL40 and LUL130 act at distinct timepoints during the backward stepping cycle, with LBL40 providing the hindleg power stroke during stance phase and LUL130 neurons subsequently initiating swing phase.
165	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	2	We tested these hypotheses by silencing either the LBL40 or LUL130 cells in tethered flies induced to walk backwards by MDN activation, and tracking the resulting hindleg joint movements.
166	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	3	Such experiments required an optogenetic silencer and an activator that could be independently controlled with minimal crosstalk.
167	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	4	We found that we could best achieve this by stimulating CsChrimson with 660 nm red light and the neuronal silencer GtACR2 [37] with 470 nm blue light.
168	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	5	With these tools, we established a protocol using tethered and decapitated flies in which CsChrimson was expressed in the MDNs and GtACR2 in either the LBL40 or LUL130 neurons.
169	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	6	Positive control flies expressed GtACR2 in the MDNs; negative controls used an “empty” split-GAL4 driver that resulted in no GtACR2 expression.
170	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	7	Each fly was subject to a series of control and experimental trials (Fig 7a).
171	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	8	Control trials consisted solely of a 25-s red-light stimulus to activate the MDNs.
172	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	1	9	Experimental trials additionally included a 10-s blue-light stimulus to silence the LBL40 or LUL130 neurons, applied 10-s after the onset of the red-light stimulus.
173	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	2	1	In positive control flies, MDN-induced backward walking was fully suppressed by optogenetic silencing of the MDNs themselves (Fig 7b).
174	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	2	2	Conversely, negative control flies were unaffected by the blue-light stimulus in experimental trials (Fig 7c).
175	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	2	3	When LBL40 neurons were silenced, the power stroke appeared to be weakened, as suggested by the reduced speed and amplitude of tibia flexion, and hence a slight delay in the initiation of swing (Fig 7c and Supplementary Movie 6).
176	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	2	4	In contrast, when LUL130 neurons were silenced, the power stroke was unaffected, as judged by the initial speed of tibia flexion.
177	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	2	5	However, in these LUL130-silenced flies, the leg appeared to be stuck in stance phase, with the tibia flexing to a much greater extent before swing was eventually initiated (Fig 7c and Supplementary Movie 10).
178	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	1	We quantified these effects by measuring the femur-tibia joint angle during each step in the 10-s blue-light stimulus period of experimental trials and the corresponding periods of control trials for the same fly (Fig 7d).
179	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	2	We aligned these curves by time-point of their maxima, which typically occurred in the middle of the short swing phase, 20-30 ms before the start of stance phase.
180	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	3	From these curves we then determined, for each fly, the average initial speed and maximum extent of tibia flexion during stance phase, and the frequency of stepping, across all experimental and control trials (Fig 7e-g).
181	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	4	This analysis confirmed our initial impression that LBL40-silenced flies, but not LUL130-silenced flies, had a reduced speed of tibia flexion during the blue-light stimulus (Fig 7e).
182	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	5	In LBL40-silenced flies, the femur-tibia joint was less flexed than in negative control flies; in LUL130-silenced flies it was more flexed (Fig 7f).
183	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	6	Both LBL40- and LUL130-silenced flies took fewer steps (Fig 7g), presumably, however, for different reasons.
184	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	7	In LBL40-silenced flies, the late transition to swing phase is explained by a slower stroke (Fig 7e), not a greater degree of flexion (Fig 7f).
185	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	8	In LUL130-silenced flies, the late initiation of swing correlated with a greater flexion (Fig 7f), not a slower stroke (Fig 7e).
186	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	9	Similar results were obtained when we compared the blue-light stimulus period of experimental trials to the pre- or post-blue-light stimulus periods of the same trials, rather than to control trials (Supplementary Fig 7a, b).
187	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	3	10	We also found that the increase in hindleg stepping that results from tarsal amputation (Fig 1i, j) is similarly suppressed by LUL130 silencing, suggesting that these oscillations, like normal steps, are centrally driven (Supplementary Fig 7c).
188	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	4	1	These data thus confirm our hypotheses from the activation experiments.
189	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	4	2	LBL40 and LUL130 neurons mediate two distinct aspects of MDN-induced backward walking.
190	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	4	3	LBL40 neurons function in tibia flexion, providing the power stroke during stance phase.
191	Results; LBL40 and LUL130 function in the stance and swing phases of backward walking	4	4	LUL130 neurons facilitate leg lifting at the end of stance phase to initiate swing and complete the stepping cycle.
192	Discussion	1	1	Backward walking triggered by the MDNs is an excellent model for exploring how descending command-like neurons produce abrupt but coordinated changes in motor circuit output.
193	Discussion	1	2	The data presented here indicate that MDN acts primarily on the T3 motor circuits, such that the hindlegs become the major driving force in backward walking.
194	Discussion	1	3	The T1 and T2 motor circuits also receive MDN input, but the backward stepping of the fore- and midlegs is primarily dependent upon proprioceptive signals generated as the hindlegs propel the body backwards.
195	Discussion	1	4	Through a combination of trans-synaptic tracing and functional imaging, we identified over 30 neuronal cell types targeted by MDN-the majority of them in T3.
196	Discussion	1	5	Amongst these are the LBL40 and LUL130 neurons, which act at separate stages in the hindleg stepping cycle.
197	Discussion	1	6	LBL40, a premotor neuron for tibia flexion, mediates the power stroke in stance phase.
198	Discussion	1	7	LUL130, an interneuron that triggers leg lifting, is responsible for the initiation of swing.
199	Discussion	1	8	Together, these data suggest that the MDNs do not act solely, if at all, through a high-level bistable switch that controls the stepping direction [38], [39], but rather individually modulate each of the diverse motor outputs needed for coordinated backward walking.
200	Discussion	2	1	Tibia flexion and femur elevation are the most prominent hindleg joint movements during the stance phase of backward walking-the two movements largely occurring in synchrony to fold up the leg, thereby pulling the body backwards.
201	Discussion	2	2	The LBL40 neurons, which are specific to T3, flex the hindleg tibia by activating LUM9, one of the tibia flexor motor neurons.
202	Discussion	2	3	Femur elevation may be mediated through other MDN-effector neurons, possibly included amongst the MF and MT cell types we have not yet examined in detail.
203	Discussion	2	4	There may also be some mechanical coupling between the two joints, as we often observed femur elevation (flexion of the coxa-trochanter joint) when tibia flexion was induced by activating either LBL40 or LUM9.
204	Discussion	2	5	Such mechanical coupling between tibia flexion and femur elevation has been observed in the stick insect [40].
205	Discussion	2	6	Femur elevation was, however, generally weaker and less reliable than tibia flexion in the LBL40 activation experiments, suggesting that it is not the primary function of these neurons.
206	Discussion	3	1	LUM9 is one of a large group of motor neurons that innervate the tibia flexor muscles.
207	Discussion	3	2	It most closely resembles the “slow” tibia flexor motor neurons, which have the lowest activation threshold and highest spiking rate but generate the weakest force [33].
208	Discussion	3	3	It is possible that LBL40 also activates other tibia flexor motor neurons, but the ex vivo nature of our preparation or the limited sensitivity of our imaging method hampered our ability to detect these responses.
209	Discussion	3	4	Indeed, silencing of LBL40 suppressed MDN-induced backward walking, whereas silencing of LUM9 did not.
210	Discussion	3	5	This suggests that at least some other tibia flexor motor neurons may also be involved in backward walking.
211	Discussion	4	1	In behavioral assays, the fly typically backs up for several steps when it encounters an obstacle, despite receiving only a transient mechanosensory stimulus.
212	Discussion	4	2	However, upon artificial activation of MDNs, the fly walks backwards only so long as the stimulus persists [11], [12].
213	Discussion	4	3	These results suggest that circuits in the brain convert an acute mechanosensory stimulus into tonic activation of MDNs.
214	Discussion	4	4	This conclusion is supported by in vivo functional imaging experiments, which showed a sustained calcium response in the MDNs during bouts of backward walking [41].
215	Discussion	4	5	The LBL40 and LUM9 neurons, in contrast, are presumably only phasically active, becoming silent when the leg pauses or is re-extended.
216	Discussion	4	6	The timing of LBL40 and LUM9 activation must therefore be determined by other inputs, most likely including proprioceptive signals from the same as well as other legs [42-44].
217	Discussion	4	7	One such input may be phasic inhibition from proprioceptive neurons that are activated when the tibia nears full flexion [45].
218	Discussion	5	1	To complete the stepping cycle, the retracted leg must initiate swing and return to its extended position.
219	Discussion	5	2	Several factors act together to initiate swing, including the position of the leg, the unloading of the leg, and the loading of other legs [42], [43], [46-48].
220	Discussion	5	3	Some or all of these factors might lead to activation of the LUL130 neurons, which trigger leg lifting and initiate swing phase.
221	Discussion	5	4	It is interesting to note that the LUL130 neurons are present in all three segments but are most strongly activated by MDN in T3.
222	Discussion	5	5	Perhaps, during backward walking, the relative weighting or timing of the factors that initiate swing are most dramatically altered for the hindleg, and MDN effects these changes.
223	Discussion	5	6	For example, when walking forwards, the hindleg initiates swing from an extended position; when walking backwards, swing is initiated from the folded position.
224	Discussion	5	7	Further insight into the circuit mechanisms that initiate swing should come from mapping proprioceptive and other inputs to LUL130 neurons, and determining how MDN activity shapes LUL130’s responses to these inputs.
225	Discussion	5	8	Such circuit mapping may also help elucidate the role of LUL130 in interleg coordination.
226	Discussion	5	9	The recent release [49] of an electron-microscope volume of the VNC should greatly facilitate these circuit reconstruction efforts.
227	Discussion	6	1	We propose that, as for LBL40, it is primarily the intra- and interleg sensory feedback signals that ensure the phasic activation of LUL130 neurons despite tonic input from MDNs.
228	Discussion	6	2	But it is also possible that inhibitory pathways entirely within the central motor circuits also contribute to the alternating phasic activation of LBL40 and LUL130.
229	Discussion	6	3	These central mechanisms might include reciprocal feedforward inhibition.
230	Discussion	6	4	Feedforward inhibition from LUL130 to LBL40 could relax the tibia flexor during the return stroke, while inhibition from LBL40 to LUL130 may help keep leg grounded throughout its power stroke.
231	Discussion	6	5	In this scenario, LBL40 and LUL130 may be integral components of a central pattern generator for stepping, the neuronal basis of which has been elusive in insects.
232	Discussion	7	1	Explanations of how descending inputs from the brain control motor circuits have focused on two alternative modes of action: population coding versus command neurons [50], [51].
233	Discussion	7	2	The population model emphasizes the fact that a large number of descending neurons are often simultaneously active during a motor task [52], and that each individual type of descending neuron may have a low-level, highly localized effect on a small number of muscles [53].
234	Discussion	7	3	In this model, coordinated changes in motor output reflect the collective action of many different descending neurons, and only certain patterns of activity in these descending neurons-a population code-are capable of eliciting a behaviorally meaningful motor output.
235	Discussion	7	4	The command neuron model, in contrast, notes the profound and coordinated motor responses that can sometimes result from the activation of just a single class of descending neuron [54].
236	Discussion	7	5	Because the motor responses elicited by a single command-type neuron can involve the coordinated activation of many different muscles, command-type descending neurons are generally thought to implement a relatively high-level control of motor circuits.
237	Discussion	8	1	Computational models of backward walking in insects have posited the existence of bistable control switch for leg motor circuits, the setting of which determines whether motor rhythms are generated in a pattern that produces forward or backward walking [38], [39].
238	Discussion	8	2	Because this switch coordinately effects multiple motor outputs, it represents a high-level control embedded within the leg motor circuits.
239	Discussion	8	3	If such high-level directional switches exist in the Drosophila leg neuropils, then MDN, as a command-type descending neuron, could act by flipping these switches into the “backward” mode.
240	Discussion	8	4	Our data suggest, however, that this is not the case.
241	Discussion	8	5	We found that, of the two MDN-output neurons we examined in detail, each controls a discrete element of backward walking: hindleg tibia flexion during stance (LBL40) and leg lifting to initiate swing (LUL130).
242	Discussion	8	6	Many MDN-output neurons remain to be characterized, and it is possible that some of these may yet emerge as components of a high-level circuit switch coordinately effecting multiple motor features.
243	Discussion	8	7	Our data suggest, however, that at least some of MDN’s control is exerted at a lower level, close to motor output, and in a highly localized manner.
244	Discussion	8	8	The neuronal networks that control walking evidently operate in at least two stable states-one producing forward walking, the other backward walking.
245	Discussion	8	9	We propose that MDN may act through a distributed set of outputs, rather than a central control switch, to flip network dynamics into the backward state.
246	Discussion	8	10	In this model, MDN functions as a command-type neuron not because it acts at a higher level in motor control, but because the many discrete low-level changes it effects alter motor circuit dynamics so as to produce a clear and coordinated transition to backward walking.
247	Discussion	9	1	In light of these findings, we suggest that, in both the command-type and population coding scenarios, descending neurons can act in a highly localized, modulatory fashion, exerting their influence at the level of single muscles or muscle groups.
248	Discussion	9	2	In this view, it is not difficult to envision how evolution could shift the descending control of motor circuits up or down the continuum from a single-unit command-type control to a more combinatorial population-based control.
249	Discussion	9	3	Duplication of descending neurons and diversification of their outputs would result in a shift towards a more distributed control system, which might be favored under conditions in which flexibility or precision are advantageous.
250	Discussion	9	4	Conversely, a single descending neuron that initially has a highly specific and localized impact may become more potent over the course of evolution as it acquires new connections.
251	Discussion	9	5	An evolutionary shift in this direction might be favored if efficiency and reliability are more important than flexibility and precision.
252	Discussion	10	1	In conclusion, we propose that there is no fundamental mechanistic distinction between a command type of control and a population type of control.
253	Discussion	10	2	The former does not necessarily impinge upon motor circuits at a higher level than the latter.
254	Discussion	10	3	Rather, we suggest that these two opposing models are merely extremes on a continuum, and that both can be implemented through the distributed, low-level modulation of motor circuits.
255	Discussion	10	4	Where any single class of descending neuron falls on this spectrum depends, proximally, on the extent to which the many local modulations sum to produce a coordinated and behaviorally-relevant motor response, and ultimately, on the evolutionary trade-off between flexibility and efficiency.
256	Methods; Fly stocks	1	1	See Supplementary Table 1 for genotypes of Drosophila used in this study, and Supplementary Table 2 for full genotypes of flies used for experiments presented in each Figure.
257	Methods; Fly stocks	1	2	All flies were raised on standard semi-defined media at 25 °C, 50% relative humidity and 12--12 h light cycle except for flies used in the trans-Tango dataset, which were raised at 18 °C.
258	Methods; Fly stocks	1	3	All flies for behavioral experiments or functional imaging were sexed within 2 days after eclosion and aged on fresh food supplemented with all-trans retinal (0.2 mM) and kept in the dark (food tube wrapped with foil).
259	Methods; Fly stocks	1	4	All flies for immunohistochemistry were sexed within 2 days after eclosion and aged on fresh food.
260	Methods; Fly stocks	1	5	Both males and females were used in Fly Bowl experiments, CsChrimson activation experiments using tethered flies, and immunohistochemistry.
261	Methods; Fly stocks	1	6	For calcium imaging, MDN amputation and GtACR2 neuronal epistasis experiments, only females were used.
262	Methods; Fly stocks	1	7	For all behavioral experiments and immunostainings except for trans-Tango, 3-8-day-old adult flies were used.
263	Methods; Fly stocks	1	8	For calcium imaging, 3-20-day-old adult flies were used.
264	Methods; Fly stocks	1	9	For trans-Tango experiments, 15-40 day-old flies (raised at 18 °C) were used.
265	Methods; Behavioral assays	1	1	Neuronal epistasis experiments in Fig 4b and Supplementary Fig 3b were conducted as in ref.  [13] using the Fly Bowl setup [27].
266	Methods; Behavioral assays	1	2	Briefly, video recordings were performed under backlit infrared LEDs at 30 fps with a resolution of 1024 × 1024 pixels.
267	Methods; Behavioral assays	1	3	A group of ~25 flies were loaded into the bowl-shaped arena and allowed to walk for 60 s before the first optogenetic simulation.
268	Methods; Behavioral assays	1	4	The first 45 s of this period were used to compute the spontaneous forward walking speed in Supplementary Fig 3b.
269	Methods; Behavioral assays	1	5	A red-light source at 627 nm wavelength illuminated the entire arena uniformly to activate CsChrimson.
270	Methods; Behavioral assays	1	6	Each red-light stimulus was 5 s in duration and in 60-s intervals (onset to onset).
271	Methods; Behavioral assays	1	7	In total nine episodes of red-light stimuli were applied in one experiment with three consecutive episodes for each of 3 intensity levels from low to high: 0.158, 0.288, and 0.456 mW/mm^2.
272	Methods; Behavioral assays	2	1	Flies were anaesthetized using a cold block set to 0-1 °C and placed in a fly-shaped groove.
273	Methods; Behavioral assays	2	2	A drop of adhesive “Not-A-Glue” (Bondic, Canada) was applied to the notum of the fly using a thin metal wire.
274	Methods; Behavioral assays	2	3	A bent metal pin fixed on one end of a rod was lowered by a manual manipulator to gently touch the adhesive.
275	Methods; Behavioral assays	2	4	Then the adhesive was cured by LED light (provided with the adhesive).
276	Methods; Behavioral assays	2	5	When decapitated flies were used, we cut off fly’s head with fine scissors (Fine Science Tools, CA) before gluing.
277	Methods; Behavioral assays	2	6	The tethering process normally takes less than 3 min.
278	Methods; Behavioral assays	2	7	The tethered flies were then given a styrofoam ball (~5 mm diameter) to hold before experiments to keep them from struggling.
279	Methods; Behavioral assays	2	8	The rod with fly tethered is then attached on a manual manipulator in the ball setup.
280	Methods; Behavioral assays	2	9	The compressed air supporting the ball was carefully adjusted to the minimal level that can spin the polypropylene ball (PP ball, 6 mm in diameter, Spherotech GmbH, Germany) without the fly stepping on it.
281	Methods; Behavioral assays	2	10	The fly was then moved carefully to the top of the PP ball supported by a custom-built ball holder (Electronics workshop, Zoological Institute, University of Cologne).
282	Methods; Behavioral assays	2	11	A top camera was used to monitor the fly’s position on ball so that the fly can be properly centred.
283	Methods; Behavioral assays	2	12	From the side view, we used the minimal projected area of the wings as a sign to adjust the roll of the fly.
284	Methods; Behavioral assays	2	13	A custom-built infrared-LED ring (wavelength: 880 nm, Electronics workshop, Zoological Institute, University of Cologne) was positioned around the camera lens for illumination.
285	Methods; Behavioral assays	2	14	A few initial videos were acquired at 200 fps with a resolution of 464 × 464 pixels from a CameraLink camera VC-2MC-M340 (Vieworks, Korea) equipped with a telecentric lens TEC-M55 (Computar, USA).
286	Methods; Behavioral assays	2	15	For majority of the experiments, a USB3 camera GS3-U3-23S6M-C (FLIR, Canada) equipped with a 75 mm zoom lens with extension tube (to further increase the zoom so that the field of view on the 1/1.2 inch CMOS chip is ~12 mm in width) and an infrared filter was controlled by Spinnaker software (FLIR, Canada) to acquire videos from the side view of fly.
287	Methods; Behavioral assays	2	16	For the FLIR camera, videos were initially acquired at 200 fps at a resolution of 960 × 800 and then cropped and downsized to 464 × 464 to match the videos taken from the Vieworks camera.
288	Methods; Behavioral assays	2	17	Data from both Vieworks and FLIR cameras were analyzed by the same DeepLabCut model.
289	Methods; Behavioral assays	2	18	Only for SS50975 activation experiments, two Basler acA1920-155um cameras (Basler AG, Germany) equipped with Infinistix 1 × 94 mm lens (with a 5.8 mm aperture retainer ring and an infrared filter; Infinity Photo-optical Company, CO) were used under control of Pylon software (Basler AG, Germany) to take videos simultaneously from both sides of the body.
290	Methods; Behavioral assays	2	19	In those experiments, frame rate was 200 fps and frame size was 960 × 480.
291	Methods; Behavioral assays	2	20	Movies from Basler cameras were manually scored.
292	Methods; Behavioral assays	2	21	An Arduino UNO (Arduino.cc) was used to synchronize cameras and optogenetic stimuli.
293	Methods; Behavioral assays	2	22	A custom built 660 nm diode laser with fibre coupling (Electronics workshop, Zoological Institute, University of Cologne) was used to deliver the red-light stimulus for CsChrimson.
294	Methods; Behavioral assays	2	23	A fiber coupled 470 nm LED (M470F1, Thorlabs, NJ) controlled by a custom LED driver (QBI Workshop, Australia) was used to deliver the blue-light stimulus for GtACR2.
295	Methods; Behavioral assays	2	24	Multimode optical fibers (Ø200 µm, 0.39 NA for red light; Ø200 µm, 0.50 NA for blue light; Thorlabs, NJ) were used to deliver light to the flies (both with SMA coupling to source and clean-cut bare end pointing to sample).
296	Methods; Behavioral assays	2	25	The red-light intensity used for 50-ms (Fig 5f, g and Supplementary Movie 6), 5-s (Fig 1, Fig 5c-e, Fig 6d, e, g, h, Supplementary Fig 5, Supplementary Fig 6c, d, and Supplementary Movies 1, 2, 9) and 25-s pulses (Fig 7, Supplementary Fig 7, and Supplementary Movies 10, 11) was ~0.73 mW/mm^2 and the intensity for 5-ms pulses (Fig 6c, Fig 6f and Supplementary Movie 8) was ~3.8 mW/mm^2.
297	Methods; Behavioral assays	2	26	The blue light intensity (Fig 7, Supplementary Fig 7, and Supplementary Movies 10, 11) was ~0.11 mW/mm^2.
298	Methods; Behavioral assays	2	27	For MDN > CsChrimson activation experiments, we first allowed the flies to walk freely in order to capture spontaneous forward walking episodes and then triggered backward walking using a 5-s constant red-light stimulus.
299	Methods; Behavioral assays	2	28	For tarsal amputation experiments, we first recorded from intact flies and then cut off the tarsal tip at the middle of the tarsus on cold block with a pair of fine scissors before recording again from the same flies with identical protocol.
300	Methods; Behavioral assays	2	29	For SS > GtACR2 neuronal epistasis experiments, we first tested if a decapitated fly could walk backwards steadily during the 25-s red-light stimulus.
301	Methods; Behavioral assays	2	30	Only flies that showed stable baseline backward walking throughout the 25-s window were further tested.
302	Methods; Behavioral assays	2	31	We performed exactly the same number of control trials and experimental trials in an alternating sequence on each fly.
303	Methods; Immunohistochemistry	1	1	Immunohistochemistry was performed on the central nervous system (CNS) dissected from adult flies, following protocols in https://www.janelia.org/project-team/flylight/protocols.
304	Methods; Immunohistochemistry	1	2	Samples for MCFO, mVenus and GFP staining and tdTomato/TNT double staining were DPX mounted.
305	Methods; Immunohistochemistry	1	3	Samples for trans-Tango and GRASP experiments were mounted in Vectashield (Vector Laboratories, CA).
306	Methods; Immunohistochemistry	1	4	Confocal stacks were obtained at 1 µm intervals using an LSM 710 microscope (Carl Zeiss AG, Germany) with a ×20 objective, or a ×40 objective for MCFOs.
307	Methods; Immunohistochemistry	2	1	For trans-Tango experiments, the flies were aged at 18 °C for 15-40 days before dissection.
308	Methods; Immunohistochemistry	2	2	We found in pilot experiments that MDN-1 > trans-Tango flies showed only sparse or no labeling of postsynaptic cells, but a UAS-CsChrimson-mVenus transgene enhanced the trans-Tango signal dramatically even in the absence of a red-light stimulus or retinal food.
309	Methods; Immunohistochemistry	2	3	For stochastic trans-Tango, two genotypes with different hs-FLP transgenes were used (see Supplementary Table 2 for full genotypes), and the data pooled.
310	Methods; Immunohistochemistry	2	4	Flies were heat-shocked at 37 °C for 1-3 sessions each lasting 2 h at various stages from first-instar larvae to mid-pupae.
311	Methods; Immunohistochemistry	2	5	We diversified the heat-shock protocol in order to get sparse labeling as well as high coverage of postsynaptic cells.
312	Methods; Immunohistochemistry	2	6	When multiple heat shocks were performed, they were spaced by at least 1 day.
313	Methods; Immunohistochemistry	2	7	More than a thousand samples were dissected and stained, of which 541 samples with sparse to medium expression were registered against a VNC template (JRC2017, ref.  [19]) and further analyzed.
314	Methods; Immunohistochemistry	2	8	The antibodies and concentrations used in those experiments were as follows: primary rabbit anti-GFP (Merck/Millipore AB-3080P, 1:1000), primary rat anti-HA (Roche 11867423001, 1:100), primary mouse anti-Bruchpilot (Developmental Studies Hybridoma Bank nc82, 1:20), secondary Alexa Fluor 488 goat anti-rabbit (Thermo Fisher Scientific A-11034, 1:500), secondary Alexa Fluor 555 goat anti-rat (Thermo Fisher Scientific A-21434, 1:800), and secondary Alexa Fluor 647 goat anti-mouse (Thermo Fisher Scientific A-21236, 1:500).
315	Methods; Immunohistochemistry	3	1	For mVenus and GFP staining, the antibodies used were as follows: primary rabbit anti-GFP (Thermo Fisher Scientific A-11122, 1:1000), primary mouse anti-Bruchpilot (1:30), secondary Alexa Fluor 488 goat anti-rabbit (1:800) and secondary Alexa Fluor 568 goat anti-mouse (Thermo Fisher Scientific A-11031, 1:400).
316	Methods; Immunohistochemistry	3	2	For MCFO, the majority of experiments were hybrid immunohistochemistry/chemical tag stainings, following the protocol listed in the abovementioned website (see also ref.
317	Methods; Immunohistochemistry	3	3	[55]).
318	Methods; Immunohistochemistry	3	4	The antibodies and dyes used were Cy2 SNAP-tag ligand (Luke Lavis, JRC, 10 μL/mL for final concentration of 2 μM), primary rat anti-FLAG Tag (Novus Biologicals NBP1-06712, 1:200), primary rabbit anti-HA Tag (Cell Signal Technologies 3724 S, 1:300), secondary ATTO647N goat anti-rat (Rockland 612-156-120, 1:300), secondary AF594 donkey anti-rabbit (Jackson ImmunoResearch 711-585-152, 1:500), and DL550 mouse anti-V5 (AbD Serotec MCA1360D550GA, 1:500).
319	Methods; Immunohistochemistry	3	5	A few experiments were immunohistochemistry only and only differed from the hybrid protocol in that mouse anti-Bruchpilot (1:30) and Cy2 Goat anti-mouse (Jackson ImmunoResearch 711-585-152, 1:600) were used instead of the Cy2 SNAP-tag ligand.
320	Methods; Immunohistochemistry	3	6	For tdTomato and TNT double labeling, the antibodies used were as follows: primary rabbit anti-TNT (Statens Serum Institute 65873, 1:3000), primary rat anti-RFP (Chromotek 5f8-20, 1:500), primary mouse anti-Bruchpilot (1:30), secondary Alexa Fluor 488 goat anti-rabbit (Thermo Fisher Scientific A-11034, 1:800), secondary Cy3 goat anti-rat (Jackson ImmunoResearch 112-165-167, 1:1000), and secondary Cy5 goat anti-mouse (Jackson ImmunoResearch 115-175-166, 1:1000).
321	Methods; Immunohistochemistry	3	7	For GRASP experiments, we used polyclonal antibody rabbit anti-GFP (AB-3080P, 1:1000) followed by secondary Alexa Fluor 647 goat anti-rabbit (Thermo Fisher Scientific A-21245, 1:500) to label GFP1-10 and imaged the live fluorescence for reconstituted GFP and tdTomato, which was co-expressed with GFP11.
322	Methods; Immunohistochemistry	3	8	For leg muscle innervation in Supplementary Fig 6a, the flies were fixed in 4% paraformaldehyde overnight at 4 °C.
323	Methods; Immunohistochemistry	3	9	After five times of 15-min washing in 0.3% PBST, we removed the legs with forceps and mounted them in Vectashield.
324	Methods; Immunohistochemistry	3	10	We then imaged live fluorescence of mVenus and RFP for nerves and muscles respectively.
325	Methods; Calcium imaging	1	1	All calcium imaging experiments were performed on ex vivo preparations of the fly CNS.
326	Methods; Calcium imaging	1	2	The entire CNS of female flies were dissected in extracellular solution comprising (in millimoles): 103 NaCl, 3 KCl, 5 N-Tris(hydroxymethyl)methyl-2-aminoethanesulfonic acid (TES), 8 trehalose, 10 glucose, 26 NaHCO3, 1 NaH2PO4, 2 CaCl2, and 4 MgCl2 (pH near 7.3 when bubbled with 95% (vol/vol) O_2 and 5% (vol/vol) CO_2 (carbogen)).
327	Methods; Calcium imaging	1	3	The extracellular solution was bubbled with carbogen and prechilled on ice before dissection.
328	Methods; Calcium imaging	1	4	After dissection, the tissues were quickly transferred to a custom chamber filled with fresh extracellular solution and stuck to a fresh glass coverslip placed at the bottom of the chamber.
329	Methods; Calcium imaging	1	5	The chamber was then placed on the stage under microscope and constantly perfused with fresh extracellular solution bubbled with carbogen throughout the experiments.
330	Methods; Calcium imaging	1	6	The room temperature was controlled at 23 °C.
331	Methods; Calcium imaging	2	1	Two-photon imaging was performed on a Thorlabs Bergamo II microscope equipped with a Galvo-Resonant scanner (Thorlabs, NJ).
332	Methods; Calcium imaging	2	2	A piezo objective focus module with 400 µm travel distance (Physik Instrumente GmbH & Co.
333	Methods; Calcium imaging	2	3	KG, Germany) was used to control an Olympus XLUMPLFLN ×20 water immersion objective (Olympus, Japan).
334	Methods; Calcium imaging	2	4	A Mai Tai DeepSee Ti:Sapphire laser (Spectra-Physics, CA) was tuned to 920 nm for two-photon stimulation.
335	Methods; Calcium imaging	2	5	A Pockels Cell (Conoptics Inc., CT) was used to control the laser intensity and ramp it while scanning deeper into the tissue.
336	Methods; Calcium imaging	2	6	A 617 nm LED source (M617F1, Thorlabs, NJ) controlled by a LED driver (DC4104, Thorlabs, NJ) was coupled to the two-photon light path to deliver the optogenetic stimuli through the objective.
337	Methods; Calcium imaging	2	7	A 594 nm long pass dichroic was used pass the 920 nm laser and 617 nm red light and reflect fluorescence from the sample to a pair of GaAsP PMTs (Hamamatsu, Japan).
338	Methods; Calcium imaging	2	8	A 562 nm long pass dichroic was placed between the two PMTs and a 525/50 nm band pass filter was placed in front of the PMT that was used to detect light from GCaMP.
339	Methods; Calcium imaging	2	9	During an imaging session, an Arduino UNO (Arduino.cc) was used to trigger and synchronize two-photon imaging and optogenetic stimulus.
340	Methods; Calcium imaging	3	1	All imaging experiments were performed under the streaming mode in Thorimage software (Thorlabs, NJ).
341	Methods; Calcium imaging	3	2	We scanned 27 effective slices spaced by 6 µm plus three flyback slices (discarded during analysis) to cover a whole VNC volume.
342	Methods; Calcium imaging	3	3	The imaging frame was set to 512 × 1024 pixels and zoomed to just cover the full VNC.
343	Methods; Calcium imaging	3	4	Under such a condition, the imaging speed was approximately 30 frames or 1 VNC volume per second.
344	Methods; Calcium imaging	3	5	The laser power on sample was ranging from 1.5 to 20 mW dependent on the driver line’s strength and depth of scanning plane.
345	Methods; Calcium imaging	3	6	We performed recording sessions containing 60 volumes (~1 min) and gave the sample either 1 red-light stimulus lasting 20 s (onset from imaging start: 10 s; see Fig 3d-f, Fig 5a, Fig 6a, Supplementary Fig 2a, and Supplementary Fig 6a, e) or 2 stimuli each lasting 1 s (onset from imaging start: 10 s and 40 sec; see Fig 5i, Supplementary Fig 2b, and Supplementary Fig 6e).
346	Methods; Calcium imaging	3	7	Each red-light stimulus contains a train of 5 ms pulses at 50 Hz.
347	Methods; Calcium imaging	3	8	The light power (not peak power; 25% duty cycle as a result of 5 ms pulses at 50 Hz) measured at the sample was 0.81 mW.
348	Methods; Calcium imaging	3	9	Given the field of view under the ×20 objective was approximately 0.9 mm in diameter, we calculated the light intensity was approximately 1.27 mW/mm^2.
349	Methods; Calcium imaging	3	10	In a typical experiment, we repeat 10 such 60-s sessions on each sample, with a 15-s interval between sessions.
350	Methods; Functional imaging screen	1	1	Starting from relatively broad lines and patterns we saw from trans-Tango experiments, we selected ~300 GAL4 or LexA lines from the GMR [22] and VT collections [23] with progressively sparser expression patterns until we can pinpoint any single cell types from the calcium imaging patterns responding to MDN activation.
351	Methods; Functional imaging screen	1	2	We used MDN-1-GAL4 (VT044845-ZpGAL4DBD in attP40, VT050660-p65ADZp in attP2, ref.  [11]) to drive expression of Chrimson88 specifically in MDNs when we imaged LexA lines.
352	Methods; Functional imaging screen	1	3	We used a split MDN-LexA (VT049484-ZpLexADBD in JK22c, VT050660-p65ADZp in attP2, ref.  [12]) to drive expression of CsChrimson in MDNs when we imaged GAL4 lines.
353	Methods; Functional imaging screen	1	4	The latter used the same enhancer combinations as the MDN + MAN-1-GAL4 [11] and expressed in both MDNs and MANs but no other central neurons.
354	Methods; Functional imaging screen	1	5	To exclude the possibility that MANs were responsible for activating a given cell type, we also used a MDN-LexA (VT044845-LexA, ref.  [13]), which is broader but does not label MAN, to confirm the response we saw from a positive GAL4 line is attributable to MDN activation.
355	Methods; Functional imaging screen	1	6	For the screen, we typically imaged two samples per line with the 20-s photostimulation protocol and rescreened the few lines that showed inconsistent patterns.
356	Methods; Functional imaging screen	1	7	Combining the results from both GAL4 and LexAs, we identified 33 cell types of which the calcium imaging patterns can be clearly matched to a neuron from MCFO patterns driven by lines containing the same enhancer as those we used for calcium imaging.
357	Methods; Functional imaging screen	1	8	We considered cells in different segments as segmentally repeating cell types if they shared common genetic drivers and had similar morphology.
358	Methods; Functional imaging screen	1	9	Many cell types were hit by multiple GAL4 or LexA lines (see Supplementary Data).
359	Methods; Functional imaging screen	1	10	We selected at least one line for each cell type and expanded the sample numbers to at least five, with which we applied both 20-s and 1-s stimulation protocols, as shown in Fig 3 and Supplementary Fig 2.
360	Methods; Neuron segmentation	1	1	To segment an MF neuron type, we obtained stochastic labeling images using GAL4 lines containing the same enhancers that were used for calcium imaging to drive expression of a MCFO reporter [24] (see Supplementary Table 2 for full genotypes).
361	Methods; Neuron segmentation	1	2	To segment an MT neuron type, we used images from the stochastic trans-Tango dataset in Fig 1b.
362	Methods; Neuron segmentation	1	3	In both cases, we selected images that showed relatively sparse patterns surrounding the neuron of interest.
363	Methods; Neuron segmentation	1	4	For MDN (Fig 5a, Fig 6a and Supplementary Fig 6e), we used an image from the MDN stochastic labeling dataset reported in ref.
364	Methods; Neuron segmentation	1	5	[13].
365	Methods; Neuron segmentation	1	6	All VNC images were nonrigidly registered [56] to JRC2017 template [19] and brains to JFRC2013 template [57].
366	Methods; Neuron segmentation	1	7	Using the software VVD Viewer [19], [58], [59], we rendered the registered image stacks in 3D and manually masked other neurons co-labeled in the image and segmented out the neuron of interest.
367	Methods; Generation of split-GAL4 lines targeting MF cell types	1	1	As part of a large effort to systematically targeting cell types in leg neuropils (R.
368	Methods; Generation of split-GAL4 lines targeting MF cell types	1	2	M., K.
369	Methods; Generation of split-GAL4 lines targeting MF cell types	1	3	F., and B.
370	Methods; Generation of split-GAL4 lines targeting MF cell types	1	4	D, in preparation), we used images of targeted cell types to generate Color-MIP masks and search through the images of GMR and VT lines [19] to obtain enhancers that may contain the cell type of interest.
371	Methods; Generation of split-GAL4 lines targeting MF cell types	1	5	We made combinations of these enhancers pairwise in split-GAL4 halves [23], [25] and tested their expression patterns by immunostaining.
372	Methods; Generation of split-GAL4 lines targeting MF cell types	1	6	For those pairs that sparsely labeled the neuron types of interest, we stabilized them by double balancing the AD and DBD halves to obtain the SS lines.
373	Methods; Quantification and statistical analysis	1	1	From the 4-D raw data of imaging, we first concatenated 10 of the 60-s recording sessions on the same sample to create a 600-frame hyperstack containing 1024 × 512 × 27 voxels.
374	Methods; Quantification and statistical analysis	1	2	We then performed motion-correction on each of the 27 slices using the NoRMCorre algorithm [60].
375	Methods; Quantification and statistical analysis	1	3	We also generated two GCaMP6s kernels for both the 20-s and 1-s stimuli.
376	Methods; Quantification and statistical analysis	1	4	To do this, we manually defined ROIs on neurons that showed strong activation with short delay and calculated the ΔF/F_0.
377	Methods; Quantification and statistical analysis	1	5	By averaging multiple such ROIs, we created smooth response curves that capture typical response dynamics to our MDN activation protocols.
378	Methods; Quantification and statistical analysis	1	6	We then calculated the cross-covariance between the time series of each voxel and the corresponding kernel using the Matlab function “xcov” with the “maxlag” parameter set to 5.
379	Methods; Quantification and statistical analysis	1	7	This parameter allowed us to detect time-shifted responses that could come from polysynaptic connections to MDN.
380	Methods; Quantification and statistical analysis	1	8	The cross-covariance analysis resulted in 11 values for each voxel.
381	Methods; Quantification and statistical analysis	1	9	We used the maximal positive values or 0 if all 11 were negative to reconstruct an image stack that represents the “activated” voxels (cyan in Fig 3b, c, Fig 5a, i, Fig 6a and Supplementary Fig 6e).
382	Methods; Quantification and statistical analysis	1	10	Likewise, we used the minimal negative values or 0 if all 11 were positive to reconstruct an image stack that represents the “inhibited” voxels (red in Fig 3b).
383	Methods; Quantification and statistical analysis	1	11	We compared these images with immunostainings of the same or other driver lines to identify neurons that respond to MDN activation or select sparser lines to narrow down the pattern.
384	Methods; Quantification and statistical analysis	1	12	We also used these images as a guide to define ROIs on neurons of interest to calculate ΔF/F_0.
385	Methods; Quantification and statistical analysis	1	13	We manually defined ROIs using the freehand or polygon tools in Fiji [61].
386	Methods; Quantification and statistical analysis	1	14	For each sample, the ROI was defined on a single imaging plane that showed strong responses and large areas for the given neuron type.
387	Methods; Quantification and statistical analysis	1	15	For neuron types containing multiple cells with overlapping neurites, the ROIs may cover multiple neurons of the same type.
388	Methods; Quantification and statistical analysis	1	16	For neuron types containing a single neuron and the counterparts in each hemisphere do not overlap, we defined the ROIs on the neuron that showed stronger response in each sample.
389	Methods; Quantification and statistical analysis	1	17	To calculate ΔF/F_0, we took the averaged intensity in each ROI from frame 2-9 for each of the 60-s imaging sessions as the baseline F_0.
390	Methods; Quantification and statistical analysis	1	18	For each sample, we then calculated averaged ΔF/F_0 of the 10 imaging sessions.
391	Methods; Quantification and statistical analysis	1	19	The averaged ΔF/F_0 from multiple samples were used to compute the response curves (see Fig 3d-f, Fig 5a, i, Fig 6a, and Supplementary Fig 6e) and quantify the maximal responses (see Supplementary Fig 2) for each cell type.
392	Methods; Quantification and statistical analysis	2	1	Movies recorded from the Fly Bowl were tracked and analyzed using a pipeline based on Ctrax [62].
393	Methods; Quantification and statistical analysis	2	2	Briefly, all flies were first tracked in each frame throughout the video.
394	Methods; Quantification and statistical analysis	2	3	Forward/backward speed (in Ctrax output reported as “du_ctr”) were further analyzed to generate results in Fig 4b and Supplementary Fig 3b.
395	Methods; Quantification and statistical analysis	2	4	This only considers the centroid’s speed component in parallel with the animal’s heading, excluding any sideways component (perpendicular to the fly’s heading).
396	Methods; Quantification and statistical analysis	2	5	Spontaneous forward walking and triggered backward walking distance for each fly was computed individually and results for all flies from multiple assays of each genotype were pooled.
397	Methods; Quantification and statistical analysis	2	6	For forward walking distance, the total forward/backward distance for flies walked in the initial 45 s (15 s prior to the first episode of red-light stimulus) of the assay was computed.
398	Methods; Quantification and statistical analysis	2	7	For backward walking distance, the accumulative backward distance (a backward speed threshold > =1.5 mm/s was applied as in ref.  [13]) during the nine episodes of red-light stimuli (3 red-light levels, three episodes each level, 5 s each episode, in total 45 s) was computed.
399	Methods; Quantification and statistical analysis	2	8	In both cases, the walking distance was calculated by integrating the forward/backward speed frame by frame throughout the time windows without considering the flies’s position in the arena.
400	Methods; Quantification and statistical analysis	3	1	An artificial neural network was trained using DeepLabCut software [16], [63] to mark four joints and the tarsal tip of each leg, two antenna and three points on the abdomen (as illustrated in Fig 1a) of a fly either walking on ball or being suspended.
401	Methods; Quantification and statistical analysis	3	2	In total 780 frames out of 39 videos sized 464 by 464 were manually marked as the training set.
402	Methods; Quantification and statistical analysis	3	3	The frames were carefully chosen to represent flies under different conditions and performing different motor tasks and a few pilot networks were trained and evaluated to extract some of the frames included in the final training set.
403	Methods; Quantification and statistical analysis	3	4	The final network was trained by this training dataset from the default resnet101 weights for 1030000 iterations.
404	Methods; Quantification and statistical analysis	3	5	All the videos analyzed by the network were overlaid with the markings (see Fig 1a) for manual quality control.
405	Methods; Quantification and statistical analysis	3	6	Tracking errors were usually limited to very few frames.
406	Methods; Quantification and statistical analysis	3	7	Time series of joint angles (as illustrated in Fig 1b) and tarsal tip y positions were batch computed and plotted to facilitate human inspection.
407	Methods; Quantification and statistical analysis	3	8	For the dataset in Fig 1b-h, only videos that did not contain obvious tracking errors for any joints were used.
408	Methods; Quantification and statistical analysis	3	9	For all cases in which femur-tibia and/or coxa-trochanter angles were plotted and quantified, manual quality control was applied on the relevant joints to exclude videos that had obvious mistracking.
409	Methods; Quantification and statistical analysis	3	10	Z-scored tarsal tip y positions were then used to detect the peak of each swing phase (referred to as “swing peak” hereafter) by Matlab function ‘findpeaks’.
410	Methods; Quantification and statistical analysis	3	11	For all cases where individual steps were extracted or stepping frequency were quantified, manual quality control was applied to correct the errors in swing peak detection.
411	Methods; Quantification and statistical analysis	4	1	For Fig 1b-h, we used a dataset containing one episode of spontaneous forward walking and one episode of optogenetically triggered backward walking for each of the seven flies.
412	Methods; Quantification and statistical analysis	4	2	Manual proofreading ensured errors in joint position tracking and swing peak detection (see above) were minimal for this dataset.
413	Methods; Quantification and statistical analysis	4	3	Using the swing peaks, we aligned all the steps across flies and averaged the tarsal tip positions and joint angles to plot the data in Fig 1c, d.
414	Methods; Quantification and statistical analysis	4	4	For Fig 1d, the 0.5 s time window contained the swing peak at frame 50, 49 preceding frames, and 50 subsequent frames.
415	Methods; Quantification and statistical analysis	4	5	If a neighbouring swing peak falls into this time window, we truncated the step.
416	Methods; Quantification and statistical analysis	4	6	So for each step, the boundary was either the abovementioned time window or shortly after the previous swing peak or before the next swing peak.
417	Methods; Quantification and statistical analysis	4	7	The grey areas indicating swing phase were determined by the inflection point of the positions of tarsal tips of the averaged steps.
418	Methods; Quantification and statistical analysis	4	8	The step size was defined as the distance between Anterior Extreme Position (AEP) and Posterior Extreme Position (PEP).
419	Methods; Quantification and statistical analysis	4	9	The swing stroke amplitude was defined as the distance between the Dorsal Extreme Position (DEP) and the line segment connecting AEP and PEP.
420	Methods; Quantification and statistical analysis	4	10	The joint angle range was defined as the maximum minus the minimum of each joint angle during a step.
421	Methods; Quantification and statistical analysis	4	11	To plot Fig 1e-h, we calculated the mean of relevant parameters from all steps for each fly, which represented a single data point in these plots.
422	Methods; Quantification and statistical analysis	5	1	For Fig 1i, j we used a dataset containing 5-10 trials each before and after tarsal amputation for each fly.
423	Methods; Quantification and statistical analysis	5	2	The amputated legs technically did not have a stance phase, but they showed oscillations resembling steps.
424	Methods; Quantification and statistical analysis	5	3	So we refer to the highest tarsal tip position during each oscillation as swing peak here for simplicity.
425	Methods; Quantification and statistical analysis	5	4	We detected and manually corrected the timing of swing peaks of all steps for intact legs or all oscillations for amputated legs.
426	Methods; Quantification and statistical analysis	5	5	Using this information, we could calculate the averaged frequency of steps or oscillations for each leg in each fly across multiple trials, which represent single data points in Fig 1j.
427	Methods; Quantification and statistical analysis	5	6	The step frequency in Supplementary Fig 5c and Supplementary Fig 7c was quantified in the same way.
428	Methods; Quantification and statistical analysis	6	1	For Fig 5e and Supplementary Fig 6d, we used a dataset that contained a single trial for each fly, in which the tracking of coxa-trochanter and femur-tibia joint angles in hindlegs had minimal errors.
429	Methods; Quantification and statistical analysis	6	2	Given many of the flies with LBL40 activated showed re-extension of tibia following initial flexion, we quantified the maximal flexion in 1 s after optogenetic stimuli onset before such re-extension.
430	Methods; Quantification and statistical analysis	7	1	For Fig 5f, g we used 50-ms light pulses spaced by at least 1 s to activate the neuron.
431	Methods; Quantification and statistical analysis	7	2	We aligned 105 trials from three flies by the stimulus onset and overlaid the femur-tibia angle to plot Fig 5f.
432	Methods; Quantification and statistical analysis	7	3	We then divided all the trials by whether re-extension of tibia followed the initial flexion and plotted the minimal femur-tibia joint angle following each stimulus to generate Fig 5g.
433	Methods; Quantification and statistical analysis	8	1	For Fig 6e, we manually scored whether a leg showed repeated stepping under 5-s red-light stimuli for each leg of the flies in this dataset.
434	Methods; Quantification and statistical analysis	8	2	For Fig 6f, we used 5-ms light pulses spaced by at least 1 s to activate the neuron.
435	Methods; Quantification and statistical analysis	8	3	We aligned 100 trials from three flies by the stimulus onset and calculated the average of each joint angle from all trials.
436	Methods; Quantification and statistical analysis	8	4	We took the averaged joint angles during the first 0.5 s after stimulus onset to calculate the Z-score (number of standard deviations from the mean).
437	Methods; Quantification and statistical analysis	8	5	For Fig 6g, we manually scored every frame as either stance or swing for each leg.
438	Methods; Quantification and statistical analysis	8	6	We can use this information to calculate the co-swing index to plot Fig 6h.
439	Methods; Quantification and statistical analysis	8	7	The co-swing index was defined by the total co-swing time of two limbs divided by the total time either of the two limbs were in swing during the optogenetic stimulation.
440	Methods; Quantification and statistical analysis	8	8	This dataset included one video with 5-s stimuli for each of the 5 flies.
441	Methods; Quantification and statistical analysis	9	1	For Fig 7d-g and Supplementary Fig 7a, b, we used a dataset containing the same number of control trials and experimental trials for each fly, following the protocol illustrated in Fig 7a.
442	Methods; Quantification and statistical analysis	9	2	We detected and manually corrected all swing peaks (see above) for hindlegs.
443	Methods; Quantification and statistical analysis	9	3	We then aligned all steps that happened during the specified time windows (10-s window delayed by 10 s after red-light onset for Figs. 7d-g and 5-s windows as illustrated in Supplementary Fig 7a, b) for each genotype and experimental condition using the swing peaks.
444	Methods; Quantification and statistical analysis	9	4	We used a 300-frame (1.5 s) time window and placed the swing peak at frame 40 (200 ms before the swing peak was shown) to plot Fig 7d.
445	Methods; Quantification and statistical analysis	9	5	We truncated steps at boundaries of the abovementioned time windows or eight frames (40 ms) before the next swing peak if the next step arose within the 1.5 s time window.
446	Methods; Quantification and statistical analysis	9	6	For Fig 7e-g, we calculated the mean of relevant parameters in all steps for each fly and condition.
447	Methods; Quantification and statistical analysis	9	7	For Fig 7e, we applied the Matlab function “fit” with input parameter “poly1” on the declining phase (from the maximal femur-tibia angle position to the boundary of the 1.5 s window, i.e., 1.3 s after the swing peak) of averaged femur-tibia angles in all steps for each fly and condition.
448	Methods; Quantification and statistical analysis	9	8	We used the linearly fitted slope as a quantification of tibia flexion speed.
449	Methods; Quantification and statistical analysis	9	9	For Fig 7f, we calculated the averaged minimal femur-tibia joint angle shortly before each swing peak of all steps for each fly and condition.
450	Methods; Quantification and statistical analysis	9	10	For Fig 7g, we took the reciprocal of the average duration (time between two neighbouring swing peaks) of all steps for each fly and condition to calculate the step frequency.
451	Methods; Quantification and statistical analysis	10	1	Details about statistical tests and sample sizes are indicated in the Figure or Figure legends.
452	Methods; Quantification and statistical analysis	10	2	All statistical analysis were performed in GraphPad Prism 8.0.
453	Methods; Quantification and statistical analysis	10	3	For all confocal images, we performed at least 2 (for images in Supplementary Fig 3a) and typically 3-5 (for images shown in other figures) independent samples and we obtained similar results across the trials.
454	Methods; Reporting summary	1	1	Further information on research design is available in the Nature Research Reporting Summary linked to this article.
